var config={apiRoot:"http://t-avihavai.users.cs.helsinki.fi/cb-back/app/"};$(document).ready(function(){editor.config.initialize(),codebrowser.initialize()});var codebrowser={app:{},models:{},collections:{},views:{},routers:{},initialize:function(){codebrowser.app.snapshot=new codebrowser.routers.SnapshotRouter,Backbone.history.start()}},editor={};editor.config=function(){function e(){var e=ace.edit("container");e.setTheme("ace/theme/terminal"),e.getSession().setMode("ace/mode/java"),e.getSession().setTabSize(4),e.setReadOnly(!1),e.setFontSize(14),e.setDisplayIndentGuides(!1),e.getSession().setUseWrapMode(!0),e.getSession().setWrapLimitRange(120,120),e.setPrintMarginColumn(120),e.setHighlightActiveLine(!0),e.setShowPrintMargin(!0),e.getSession().setUseSoftTabs(!1),e.setShowInvisibles(!1)}function o(e){ace.edit("container").getSession().setValue(e)}return{initialize:e,setCode:o}}(),codebrowser.models.File=Backbone.RelationalModel.extend({urlRoot:function(){return config.apiRoot+"students/1/courses/2/exercises/3/snapshots/"+this.get("snapshot").id+"/files"},fetchContent:function(e){$.get(this.urlRoot()+"/"+this.id,function(o){e(o)})}}),codebrowser.models.Snapshot=Backbone.RelationalModel.extend({urlRoot:config.apiRoot+"students/1/courses/2/exercises/3/snapshots",relations:[{type:Backbone.HasMany,key:"files",relatedModel:"codebrowser.models.File",collectionType:"codebrowser.collections.FileCollection",reverseRelation:{key:"snapshot"}}]}),codebrowser.models.Student=Backbone.Model.extend({urlRoot:config.apiRoot+"students"}),codebrowser.collections.FileCollection=Backbone.Collection.extend({model:codebrowser.models.File,url:function(){return config.apiRoot+"students/1/courses/2/exercises/3/snapshots/"+this.get("snapshot").id+"/files"}}),codebrowser.views.SnapshotView=Backbone.View.extend({initialize:function(){this.render()},render:function(){editor.config.setCode(this.model)}}),codebrowser.routers.SnapshotRouter=Backbone.Router.extend({routes:{"snapshots/:id":"read"},read:function(e){var o=new codebrowser.models.Snapshot({id:e});o.fetch({success:function(){console.log("Received snapshot from backend..."),console.log(o),o.get("files").at(0).fetchContent(function(e){new codebrowser.views.SnapshotView({el:$("#container"),model:e}),console.log("Done.")})},error:function(){console.log("Request failed.")}})}});